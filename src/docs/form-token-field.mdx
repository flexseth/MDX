import FormTokenField from '../components/FormTokenField';
import { useLocalStorage } from '../hooks/useLocalStorage';

export const TAG_SUGGESTIONS = [
  'WordPress', 'Gutenberg', 'React', 'JavaScript', 'PHP', 'CSS',
];

export const TagsDemo = () => {
  const [tags, setTags] = useLocalStorage('demo-form-token-tags', []);
  return (
    <div>
      <FormTokenField
        label="Post Tags"
        value={tags}
        onChange={setTags}
        suggestions={TAG_SUGGESTIONS}
        placeholder="Type a tag and press Enter…"
        help="Type a value and press Enter or comma to add it. Click × to remove."
      />
      {tags.length > 0 && (
        <div style={{ marginTop: '0.75rem', display: 'flex', gap: '0.375rem', flexWrap: 'wrap' }}>
          {tags.map((tag) => (
            <span
              key={tag}
              style={{
                background: '#eff6ff',
                color: '#1d4ed8',
                border: '1px solid #bfdbfe',
                padding: '2px 10px',
                borderRadius: '9999px',
                fontSize: '0.8125rem',
                fontWeight: 500,
              }}
            >
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>
  );
};

export const KeywordsDemo = () => {
  const [keywords, setKeywords] = useLocalStorage('demo-form-token-keywords', []);
  return (
    <FormTokenField
      label="SEO Keywords"
      value={keywords}
      onChange={setKeywords}
      maxLength={5}
      placeholder="Add up to 5 keywords…"
      help="Maximum 5 keywords. Press Enter or comma to add each one."
    />
  );
};

# FormTokenField

A multi-value token (tag/chip) input with optional autocomplete suggestions. Mirrors the WordPress [`FormTokenField`](https://developer.wordpress.org/block-editor/reference-guides/components/form-token-field/) from `@wordpress/components`.

## Basic Usage

Type a value and press Enter or comma to create a token. Click a suggestion to add it instantly. Press Backspace on an empty input to remove the last token.

<TagsDemo />

```jsx
const SUGGESTIONS = ['WordPress', 'Gutenberg', 'React', 'JavaScript', 'PHP', 'CSS'];

<FormTokenField
  label="Post Tags"
  value={tags}
  onChange={(tokens) => setAttributes({ tags: tokens })}
  suggestions={SUGGESTIONS}
  placeholder="Type a tag and press Enter…"
/>
```

## With maxLength

Limit the number of tokens a user can add with `maxLength`. The input is hidden once the limit is reached.

<KeywordsDemo />

```jsx
<FormTokenField
  label="SEO Keywords"
  value={keywords}
  onChange={(tokens) => setAttributes({ keywords: tokens })}
  maxLength={5}
  placeholder="Add up to 5 keywords…"
  help="Maximum 5 keywords."
/>
```

## Disabled State

<FormTokenField
  label="Locked Tags"
  value={['WordPress', 'Gutenberg']}
  onChange={() => {}}
  disabled
  help="These tags cannot be changed."
/>

```jsx
<FormTokenField
  label="Locked Tags"
  value={lockedTags}
  onChange={() => {}}
  disabled
  help="These tags cannot be changed."
/>
```

## WordPress Usage (edit.js)

```jsx
import { __ } from '@wordpress/i18n';
import { FormTokenField, PanelBody } from '@wordpress/components';
import { useBlockProps, InspectorControls } from '@wordpress/block-editor';

const ALL_TAGS = [
  'WordPress', 'Gutenberg', 'Blocks', 'PHP',
  'JavaScript', 'React', 'CSS', 'Accessibility',
];

export default function Edit( { attributes, setAttributes } ) {
  const blockProps = useBlockProps();
  const { tags } = attributes;

  return (
    <>
      <InspectorControls>
        <PanelBody title={ __( 'Tags', 'your-text-domain' ) }>
          <FormTokenField
            label={ __( 'Post Tags', 'your-text-domain' ) }
            value={ tags }
            suggestions={ ALL_TAGS.filter( ( t ) => ! tags.includes( t ) ) }
            onChange={ ( tokens ) => setAttributes( { tags: tokens } ) }
            placeholder={ __( 'Add a tag…', 'your-text-domain' ) }
          />
        </PanelBody>
      </InspectorControls>
      <div { ...blockProps }>
        { tags.length > 0 && (
          <div className="tag-list">
            { tags.map( ( tag ) => (
              <span key={ tag } className="tag">{ tag }</span>
            ) ) }
          </div>
        ) }
      </div>
    </>
  );
}
```

## block.json Attributes

```json
{
  "attributes": {
    "tags": { "type": "array", "default": [] }
  }
}
```

## Props

<PropsTable props={[
  {
    name: 'label',
    type: 'string',
    default: "''",
    required: false,
    description: 'Visible label rendered above the token input.'
  },
  {
    name: 'value',
    type: 'array',
    default: '[]',
    required: true,
    description: 'Array of current token strings. Controlled.'
  },
  {
    name: 'onChange',
    type: 'function',
    default: '',
    required: true,
    description: 'Callback receiving the updated array of tokens after any add or remove.'
  },
  {
    name: 'suggestions',
    type: 'array',
    default: '[]',
    required: false,
    description: 'Array of suggestion strings shown in the autocomplete dropdown while the input is focused.'
  },
  {
    name: 'maxLength',
    type: 'number',
    default: '',
    required: false,
    description: 'Maximum number of tokens allowed. The input is hidden once the limit is reached.'
  },
  {
    name: 'placeholder',
    type: 'string',
    default: "'Add item…'",
    required: false,
    description: 'Placeholder text displayed when no tokens have been added.'
  },
  {
    name: 'help',
    type: 'string',
    default: "''",
    required: false,
    description: 'Help text displayed below the input container.'
  },
  {
    name: 'disabled',
    type: 'boolean',
    default: 'false',
    required: false,
    description: 'Disables all interaction — tokens cannot be added or removed.'
  },
  {
    name: 'className',
    type: 'string',
    default: "''",
    required: false,
    description: 'Additional CSS class names applied to the wrapper element.'
  }
]} />

## WordPress Mapping

`FormTokenField` is imported from `@wordpress/components` and placed inside `InspectorControls` with a `PanelBody` for multi-value settings such as tag lists, taxonomy terms, or keyword arrays. Store the value as a `type: "array"` attribute in `block.json` with `"default": []`.

Pass a `suggestions` array filtered to exclude already-selected tokens to prevent duplicates. For large datasets loaded from the REST API, use an `onInputChange` handler with debouncing to fetch suggestions dynamically and avoid excessive network requests. Use `saveTransform` to normalize tokens before they are saved — for example `(token) => token.trim().toLowerCase()` — to ensure consistent stored values regardless of how the user typed them.
